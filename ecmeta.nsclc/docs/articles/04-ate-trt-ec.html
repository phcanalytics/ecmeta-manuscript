<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimation of average treatment effects: RCT experimental vs external control • ecmeta.nsclc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Estimation of average treatment effects: RCT experimental vs external control">
<meta property="og:description" content="ecmeta.nsclc">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ecmeta.nsclc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">API</a>
</li>
<li>
  <a href="../sap/sap.pdf">Analysis plan</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01-data-prep.html">Data preparation</a>
    </li>
    <li>
      <a href="../articles/02-impute.html">Imputation of missing data</a>
    </li>
    <li>
      <a href="../articles/03-balance.html">Propensity score estimation, weighting, and balance</a>
    </li>
    <li>
      <a href="https://connect.phcaa.science.roche.com/content/1102">Propensity score estimation, weighting, and balance (Shiny app)</a>
    </li>
    <li>
      <a href="../articles/04-ate-trt-ec.html">Treatment effect estimates: RCT experimental vs external control</a>
    </li>
    <li>
      <a href="../articles/05-ic-ec.html">Comparison of the internal and external control arms</a>
    </li>
    <li>
      <a href="../articles/06-ecmeta.html">Meta-analytic adjustment of hazard ratios</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.roche.com/incertid/ecmeta-manuscript/tree/master/ecmeta.nsclc/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="04-ate-trt-ec_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="04-ate-trt-ec_files/kePrint-0.0.1/kePrint.js"></script><link href="04-ate-trt-ec_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Estimation of average treatment effects: RCT experimental vs external control</h1>
            
            <h4 class="date">2021-09-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.roche.com/incertid/ecmeta-manuscript/tree/master/ecmeta.nsclc/vignettes/04-ate-trt-ec.Rmd"><code>vignettes/04-ate-trt-ec.Rmd</code></a></small>
      <div class="hidden name"><code>04-ate-trt-ec.Rmd</code></div>

    </div>

    
    
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<p>The objectives of this analysis is to estimate average treatment effects (ATE) using the propensity score methods assessed in <code><a href="../articles/03-balance.html">vignette("03-balance")</a></code>. We compare the experimental arm from the randomized clinical trials (RCTs) to the external control. While the primary treatment effect metric is the hazard ratio, we report survivor functions as well. The following <code>R</code> packages, settings, and global variables are used.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># R packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org">"dplyr"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.roche.com/incertid/ecmeta-manuscript/tree/master/ecmeta.nsclc">"ecmeta.nsclc"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org">"ggplot2"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://haozhu233.github.io/kableExtra/">"kableExtra"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/rstudio/pins">"pins"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://purrr.tidyverse.org">"purrr"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/therneau/survival">"survival"</a></span><span class="op">)</span>

<span class="co"># Settings</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Global variables</span>
<span class="va">RESPONSE</span> <span class="op">&lt;-</span> <span class="st">"Surv(os_days, os_status)"</span>
<span class="va">SURV_FORMULA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">RESPONSE</span>, <span class="st">" ~ treat"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ID</span> <span class="op">&lt;-</span><span class="st">"patient_id"</span>
<span class="va">GRP_ID</span> <span class="op">&lt;-</span> <span class="st">"analysis_num"</span></code></pre></div>
</div>
<div id="data" class="section level1">
<h1 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h1>
<p>All analyses are based on the preprocessed data we have used previously.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ec_rct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pins/man/pin_get.html">pin_get</a></span><span class="op">(</span><span class="st">"nsclc"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">preprocess</span><span class="op">(</span><span class="op">)</span> 

<span class="va">ec_rct1</span> <span class="op">&lt;-</span> <span class="va">ec_rct</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">source_type</span> <span class="op">==</span> <span class="st">"RCT"</span> <span class="op">&amp;</span> <span class="va">arm_type</span> <span class="op">==</span> <span class="st">"Comparator"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>However, to ensure that outcomes did not influence our propensity score models, our prior analyses did not use any outcome data. We add the outcomes data here so that we can estimate survival models.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">y_list</span> <span class="op">&lt;-</span> <span class="va">ec_rct1</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">patient_id</span>, <span class="va">analysis_num</span>, <span class="va">os_days</span>, <span class="va">os_status</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">analysis_num</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_split.html">group_split</a></span><span class="op">(</span><span class="op">)</span> </code></pre></div>
</div>
<div id="rct-benchmarks" class="section level1">
<h1 class="hasAnchor">
<a href="#rct-benchmarks" class="anchor"></a>RCT benchmarks</h1>
<p>We first obtain RCT datasets for each of the analyses so that we can generate hazard ratio benchmarks for our external control analyses.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rct_list</span> <span class="op">&lt;-</span> <span class="va">ec_rct</span><span class="op">[</span><span class="va">ec_rct</span><span class="op">$</span><span class="va">source_type</span> <span class="op">==</span> <span class="st">"RCT"</span>, <span class="op">]</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">analysis_num</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_split.html">group_split</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Hazard ratios are estimated with Cox models that include a single covariate for treatment assignment. We first estimate log hazard ratios (which we will need for our meta-analytic model) and then transform them to hazard ratios for presentation.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Estimate log hazard ratios</span>
<span class="va">rct_loghr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">rct_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html">coxph</a></span><span class="op">(</span><span class="va">SURV_FORMULA</span>, data <span class="op">=</span> <span class="va">x</span><span class="op">)</span>
  <span class="va">loghr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html">vcov</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>estimate <span class="op">=</span> <span class="va">loghr</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
         se <span class="op">=</span> <span class="va">loghr</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,
         lower <span class="op">=</span> <span class="va">loghr</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,
         upper <span class="op">=</span> <span class="va">loghr</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"analysis_num"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>analysis_num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">analysis_num</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Transform to hazard ratios</span>
<span class="va">rct_hr</span> <span class="op">&lt;-</span> <span class="va">rct_loghr</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">estimate</span>, <span class="va">lower</span>, <span class="va">upper</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">exp</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We also generate Kaplan-Meier estimates stratified by treatment assignment.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rct_surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">rct_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span><span class="op">(</span><span class="va">SURV_FORMULA</span>, data <span class="op">=</span> <span class="va">x</span><span class="op">)</span>
  <span class="fu">marginal_survival</span><span class="op">(</span><span class="va">km</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">rbind_list</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"analysis_num"</span>, integer_id <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">rct_surv</span><span class="op">)</span></code></pre></div>
<p><img src="04-ate-trt-ec_files/figure-html/rctSurv-1.png" width="768"></p>
</div>
<div id="primary-estimates" class="section level1">
<h1 class="hasAnchor">
<a href="#primary-estimates" class="anchor"></a>Primary estimates</h1>
<p>Next we compare the experimental arm from the RCTs to the external controls. Our primary estimates are based on Cox models containing a single covariate for treatment assignment that are weighted using IPTW-ATT weights.</p>
<div id="treatment-effect-estimation" class="section level2">
<h2 class="hasAnchor">
<a href="#treatment-effect-estimation" class="anchor"></a>Treatment effect estimation</h2>
<p>We load in information for each of the 14 analyses includes the propensity score weights we estimated in <code><a href="../articles/03-balance.html">vignette("03-balance")</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"analysis-balance.rds"</span><span class="op">)</span></code></pre></div>
<p>We use the <code>surv_ate()</code> function to estimate log hazard ratios and survivor functions. We iterate over each of the 14 “groups” with <code>map_surv_ate()</code>. Standard errors for the hazard ratios are clustered by patient ID and estimates are pooled across imputations using Rubin’s rule.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">primary_psw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">analysis</span><span class="op">$</span><span class="va">psweight</span>, <span class="kw">function</span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="va">x</span><span class="op">$</span><span class="va">method</span> <span class="op">==</span> <span class="st">"iptw_att_trim"</span>, <span class="op">]</span><span class="op">)</span>
<span class="va">primary_ate</span> <span class="op">&lt;-</span> <span class="fu">map_surv_ate</span><span class="op">(</span><span class="va">primary_psw</span>, ydata_list <span class="op">=</span> <span class="va">y_list</span>,
                            response <span class="op">=</span> <span class="va">RESPONSE</span>, id <span class="op">=</span> <span class="va">ID</span>,
                            grp_id <span class="op">=</span> <span class="va">GRP_ID</span>,
                            integer_grp_id <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="hazard-ratios" class="section level2">
<h2 class="hasAnchor">
<a href="#hazard-ratios" class="anchor"></a>Hazard ratios</h2>
<p>We plot the estimated hazard ratios for each analysis against the benchmarks from the RCT. Perfect estimates are those lat lie on the dotted 45 degree line.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">primary_hr</span> <span class="op">&lt;-</span> <span class="fu">benchmark_hazard_ratios</span><span class="op">(</span><span class="va">primary_ate</span>, benchmarks <span class="op">=</span> <span class="va">rct_hr</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">primary_hr</span><span class="op">)</span></code></pre></div>
<p><img src="04-ate-trt-ec_files/figure-html/primaryHr-1.png" width="768"></p>
<p>Hazard ratios and 95 percent confidence intervals estimated using each propensity score method are also displayed in the table below.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">html_table</span><span class="op">(</span><span class="va">primary_hr</span><span class="op">)</span></code></pre></div>
<table class="table table table-striped table-responsive">
<thead><tr>
<th style="text-align:right;">
analysis_num
</th>
<th style="text-align:left;">
term
</th>
<th style="text-align:left;">
benchmark
</th>
<th style="text-align:left;">
iptw_att_trim
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
0.73 (0.62-0.86)
</td>
<td style="text-align:left;">
0.58 (0.48-0.69)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
0.72 (0.54-0.98)
</td>
<td style="text-align:left;">
0.54 (0.41-0.71)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
0.77 (0.61-0.96)
</td>
<td style="text-align:left;">
0.71 (0.58-0.87)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
0.88 (0.72-1.07)
</td>
<td style="text-align:left;">
0.85 (0.58-1.24)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
0.89 (0.55-1.46)
</td>
<td style="text-align:left;">
1.47 (1.05-2.06)
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
1.38 (0.75-2.56)
</td>
<td style="text-align:left;">
1.13 (0.73-1.74)
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
1.15 (0.68-1.95)
</td>
<td style="text-align:left;">
1.34 (0.94-1.91)
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
1.08 (0.52-2.21)
</td>
<td style="text-align:left;">
0.75 (0.44-1.28)
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
1.03 (0.75-1.41)
</td>
<td style="text-align:left;">
0.92 (0.73-1.15)
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
1.04 (0.72-1.50)
</td>
<td style="text-align:left;">
0.86 (0.66-1.12)
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
1.27 (0.75-2.15)
</td>
<td style="text-align:left;">
1.09 (0.80-1.48)
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
0.79 (0.63-0.97)
</td>
<td style="text-align:left;">
0.65 (0.45-0.92)
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
0.87 (0.72-1.04)
</td>
<td style="text-align:left;">
0.76 (0.62-0.92)
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
0.87 (0.71-1.06)
</td>
<td style="text-align:left;">
0.86 (0.73-1.01)
</td>
</tr>
</tbody>
</table>
</div>
<div id="survival-curves" class="section level2">
<h2 class="hasAnchor">
<a href="#survival-curves" class="anchor"></a>Survival curves</h2>
<p>We also plot survival curves, which can be compared to the survival curves from the RCT above and used as an informal assessment of potential non-proportional hazards. In the next vignette, we will compare survival between the external and trial controls, which will provide a more direct test of the compatibility of the external control.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plot_survival</span><span class="op">(</span><span class="va">primary_ate</span>, method <span class="op">=</span> <span class="st">"iptw_att_trim"</span><span class="op">)</span></code></pre></div>
<p><img src="04-ate-trt-ec_files/figure-html/primarySurv-1.png" width="768"></p>
</div>
</div>
<div id="sensitivity-analyses" class="section level1">
<h1 class="hasAnchor">
<a href="#sensitivity-analyses" class="anchor"></a>Sensitivity analyses</h1>
<p>A number of sensitivity analyses are performed to assess sensitivity of the results to modeling assumptions.</p>
<div id="propensity-score-methods" class="section level2">
<h2 class="hasAnchor">
<a href="#propensity-score-methods" class="anchor"></a>Propensity score methods</h2>
<p>The first sensitivty analysis assess the importance of difference propensity score methods.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">psmethods_ate</span> <span class="op">&lt;-</span> <span class="fu">map_surv_ate</span><span class="op">(</span><span class="va">analysis</span><span class="op">$</span><span class="va">psweight</span>, ydata_list <span class="op">=</span> <span class="va">y_list</span>,
                              response <span class="op">=</span> <span class="va">RESPONSE</span>, id <span class="op">=</span> <span class="va">ID</span>,
                              grp_id <span class="op">=</span> <span class="va">GRP_ID</span>,
                              integer_grp_id <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>We compare the estimated and benchmark hazard ratios across the difference methodologies.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">psmethods_hr</span> <span class="op">&lt;-</span> <span class="fu">benchmark_hazard_ratios</span><span class="op">(</span><span class="va">psmethods_ate</span>, benchmarks <span class="op">=</span> <span class="va">rct_hr</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">psmethods_hr</span><span class="op">)</span></code></pre></div>
<p><img src="04-ate-trt-ec_files/figure-html/psMethodsHr-1.png" width="768"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">html_table</span><span class="op">(</span><span class="va">psmethods_hr</span><span class="op">)</span></code></pre></div>
<table class="table table table-striped table-responsive">
<thead><tr>
<th style="text-align:right;">
analysis_num
</th>
<th style="text-align:left;">
term
</th>
<th style="text-align:left;">
benchmark
</th>
<th style="text-align:left;">
iptw_att
</th>
<th style="text-align:left;">
iptw_att_trim
</th>
<th style="text-align:left;">
match_genetic
</th>
<th style="text-align:left;">
match_genetic_caliper
</th>
<th style="text-align:left;">
match_nearest
</th>
<th style="text-align:left;">
match_nearest_caliper
</th>
<th style="text-align:left;">
unadjusted
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
0.73 (0.62-0.86)
</td>
<td style="text-align:left;">
0.81 (0.46-1.43)
</td>
<td style="text-align:left;">
0.58 (0.48-0.69)
</td>
<td style="text-align:left;">
0.55 (0.47-0.65)
</td>
<td style="text-align:left;">
0.62 (0.49-0.79)
</td>
<td style="text-align:left;">
0.56 (0.47-0.66)
</td>
<td style="text-align:left;">
0.60 (0.50-0.72)
</td>
<td style="text-align:left;">
0.55 (0.47-0.64)
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
0.72 (0.54-0.98)
</td>
<td style="text-align:left;">
0.62 (0.43-0.88)
</td>
<td style="text-align:left;">
0.54 (0.41-0.71)
</td>
<td style="text-align:left;">
0.60 (0.43-0.85)
</td>
<td style="text-align:left;">
0.71 (0.48-1.05)
</td>
<td style="text-align:left;">
0.53 (0.37-0.74)
</td>
<td style="text-align:left;">
0.53 (0.38-0.74)
</td>
<td style="text-align:left;">
0.56 (0.44-0.72)
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
0.77 (0.61-0.96)
</td>
<td style="text-align:left;">
0.71 (0.58-0.86)
</td>
<td style="text-align:left;">
0.71 (0.58-0.87)
</td>
<td style="text-align:left;">
0.70 (0.56-0.87)
</td>
<td style="text-align:left;">
0.71 (0.56-0.91)
</td>
<td style="text-align:left;">
0.68 (0.55-0.83)
</td>
<td style="text-align:left;">
0.66 (0.53-0.82)
</td>
<td style="text-align:left;">
0.67 (0.55-0.81)
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
0.88 (0.72-1.07)
</td>
<td style="text-align:left;">
0.94 (0.61-1.44)
</td>
<td style="text-align:left;">
0.85 (0.58-1.24)
</td>
<td style="text-align:left;">
0.82 (0.67-1.00)
</td>
<td style="text-align:left;">
1.12 (0.73-1.71)
</td>
<td style="text-align:left;">
0.85 (0.68-1.06)
</td>
<td style="text-align:left;">
0.87 (0.60-1.28)
</td>
<td style="text-align:left;">
0.81 (0.68-0.96)
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
0.89 (0.55-1.46)
</td>
<td style="text-align:left;">
1.46 (1.04-2.05)
</td>
<td style="text-align:left;">
1.47 (1.05-2.06)
</td>
<td style="text-align:left;">
1.73 (0.98-3.03)
</td>
<td style="text-align:left;">
1.72 (0.91-3.25)
</td>
<td style="text-align:left;">
1.54 (0.85-2.80)
</td>
<td style="text-align:left;">
1.63 (0.82-3.24)
</td>
<td style="text-align:left;">
1.39 (0.99-1.95)
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
1.38 (0.75-2.56)
</td>
<td style="text-align:left;">
1.14 (0.73-1.77)
</td>
<td style="text-align:left;">
1.13 (0.73-1.74)
</td>
<td style="text-align:left;">
1.09 (0.62-1.92)
</td>
<td style="text-align:left;">
1.10 (0.60-2.00)
</td>
<td style="text-align:left;">
1.24 (0.64-2.38)
</td>
<td style="text-align:left;">
1.23 (0.62-2.45)
</td>
<td style="text-align:left;">
1.14 (0.74-1.77)
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
1.15 (0.68-1.95)
</td>
<td style="text-align:left;">
1.36 (0.95-1.94)
</td>
<td style="text-align:left;">
1.34 (0.94-1.91)
</td>
<td style="text-align:left;">
1.28 (0.75-2.18)
</td>
<td style="text-align:left;">
1.25 (0.74-2.13)
</td>
<td style="text-align:left;">
1.68 (0.86-3.28)
</td>
<td style="text-align:left;">
1.41 (0.74-2.70)
</td>
<td style="text-align:left;">
1.16 (0.84-1.61)
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
1.08 (0.52-2.21)
</td>
<td style="text-align:left;">
0.74 (0.43-1.26)
</td>
<td style="text-align:left;">
0.75 (0.44-1.28)
</td>
<td style="text-align:left;">
0.67 (0.34-1.33)
</td>
<td style="text-align:left;">
0.72 (0.37-1.39)
</td>
<td style="text-align:left;">
0.71 (0.34-1.49)
</td>
<td style="text-align:left;">
0.73 (0.37-1.42)
</td>
<td style="text-align:left;">
0.74 (0.43-1.27)
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
1.03 (0.75-1.41)
</td>
<td style="text-align:left;">
0.92 (0.73-1.15)
</td>
<td style="text-align:left;">
0.92 (0.73-1.15)
</td>
<td style="text-align:left;">
0.98 (0.71-1.34)
</td>
<td style="text-align:left;">
0.94 (0.68-1.31)
</td>
<td style="text-align:left;">
0.88 (0.62-1.26)
</td>
<td style="text-align:left;">
0.94 (0.67-1.31)
</td>
<td style="text-align:left;">
0.98 (0.79-1.20)
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
1.04 (0.72-1.50)
</td>
<td style="text-align:left;">
0.84 (0.65-1.09)
</td>
<td style="text-align:left;">
0.86 (0.66-1.12)
</td>
<td style="text-align:left;">
1.01 (0.68-1.51)
</td>
<td style="text-align:left;">
1.01 (0.69-1.48)
</td>
<td style="text-align:left;">
0.85 (0.56-1.31)
</td>
<td style="text-align:left;">
0.96 (0.62-1.49)
</td>
<td style="text-align:left;">
0.88 (0.69-1.13)
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
1.27 (0.75-2.15)
</td>
<td style="text-align:left;">
1.07 (0.79-1.46)
</td>
<td style="text-align:left;">
1.09 (0.80-1.48)
</td>
<td style="text-align:left;">
1.04 (0.68-1.59)
</td>
<td style="text-align:left;">
1.13 (0.72-1.77)
</td>
<td style="text-align:left;">
0.92 (0.55-1.54)
</td>
<td style="text-align:left;">
1.01 (0.64-1.58)
</td>
<td style="text-align:left;">
1.11 (0.82-1.51)
</td>
</tr>
<tr>
<td style="text-align:right;">
12
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
0.79 (0.63-0.97)
</td>
<td style="text-align:left;">
0.47 (0.30-0.75)
</td>
<td style="text-align:left;">
0.65 (0.45-0.92)
</td>
<td style="text-align:left;">
0.64 (0.43-0.97)
</td>
<td style="text-align:left;">
0.68 (0.44-1.04)
</td>
<td style="text-align:left;">
0.73 (0.47-1.13)
</td>
<td style="text-align:left;">
0.72 (0.47-1.12)
</td>
<td style="text-align:left;">
0.61 (0.46-0.81)
</td>
</tr>
<tr>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
0.87 (0.72-1.04)
</td>
<td style="text-align:left;">
0.80 (0.64-1.01)
</td>
<td style="text-align:left;">
0.76 (0.62-0.92)
</td>
<td style="text-align:left;">
0.80 (0.67-0.96)
</td>
<td style="text-align:left;">
0.82 (0.66-1.02)
</td>
<td style="text-align:left;">
0.80 (0.67-0.96)
</td>
<td style="text-align:left;">
0.77 (0.60-0.98)
</td>
<td style="text-align:left;">
0.80 (0.68-0.95)
</td>
</tr>
<tr>
<td style="text-align:right;">
14
</td>
<td style="text-align:left;">
treat
</td>
<td style="text-align:left;">
0.87 (0.71-1.06)
</td>
<td style="text-align:left;">
0.87 (0.74-1.02)
</td>
<td style="text-align:left;">
0.86 (0.73-1.01)
</td>
<td style="text-align:left;">
0.85 (0.70-1.05)
</td>
<td style="text-align:left;">
0.85 (0.67-1.07)
</td>
<td style="text-align:left;">
0.92 (0.73-1.17)
</td>
<td style="text-align:left;">
0.93 (0.73-1.19)
</td>
<td style="text-align:left;">
0.88 (0.75-1.02)
</td>
</tr>
</tbody>
</table>
</div>
<div id="double-adjustment" class="section level2">
<h2 class="hasAnchor">
<a href="#double-adjustment" class="anchor"></a>Double adjustment</h2>
<p>Next, we use “double adjustment” to estimate log hazard ratios, which simply includes each term in the propensity score model in the Cox model as well. Note that this results in estimation of a conditional rather than a marginal hazard ratio. We leverage the <code>update.surv_ate()</code> function to update the analysis above while only modifying the function argument of interest.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">da_ate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">psmethods_ate</span>, double_adjustment <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :
## Loglik converged before variable 4 ; coefficient may be infinite.</code></pre>
<pre><code>## Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :
## Loglik converged before variable 6 ; coefficient may be infinite.

## Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :
## Loglik converged before variable 6 ; coefficient may be infinite.

## Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :
## Loglik converged before variable 6 ; coefficient may be infinite.

## Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :
## Loglik converged before variable 6 ; coefficient may be infinite.</code></pre>
<pre><code>## Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :
## Loglik converged before variable 4 ; coefficient may be infinite.</code></pre>
<pre><code>## Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :
## Loglik converged before variable 5 ; coefficient may be infinite.</code></pre>
<p>We again compare the estimated and benchmark hazard ratios.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">da_hr</span> <span class="op">&lt;-</span> <span class="fu">benchmark_hazard_ratios</span><span class="op">(</span><span class="va">da_ate</span>, benchmarks <span class="op">=</span> <span class="va">rct_hr</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">da_hr</span><span class="op">)</span></code></pre></div>
<p><img src="04-ate-trt-ec_files/figure-html/doubleAdjustmentHr-1.png" width="768"></p>
</div>
<div id="interaction-terms-in-the-propensity-score-model" class="section level2">
<h2 class="hasAnchor">
<a href="#interaction-terms-in-the-propensity-score-model" class="anchor"></a>Interaction terms in the propensity score model</h2>
<p>An additional sensitivity analysis modifies the specification of the propensity score model by interacting the number of days since diagnosis with cancer stage (early or advanced). Since we have modeled the propensity score model, we re-impute the data (including the new interaction term in the imputation model) and all propensity score modeling steps. A complete propensity score pipeline including estimation of ATEs can be performed with <code>ps_surv()</code> and we can iterate over groups with <code>map_ps_surv()</code>. Note that we don’t perform genetic matching here due to its slow run time.</p>
<p>These less parsimonious model results in predicted propensity scores that are either 0 or 1 as noted by the warning below, a violation of the strongly ignorable treatment assignment (SITA) assumption requiring each patient to have a nonzero probability of receiving either treatment.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ec_rct1_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_split.html">group_split</a></span><span class="op">(</span><span class="va">ec_rct1</span>, <span class="va">analysis_num</span><span class="op">)</span>
<span class="va">ps_form_interaction</span> <span class="op">&lt;-</span> <span class="fu">get_ps_formula</span><span class="op">(</span>spline <span class="op">=</span> <span class="cn">FALSE</span>, interaction <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">interaction_ps_surv</span> <span class="op">&lt;-</span> <span class="fu">map_ps_surv</span><span class="op">(</span><span class="va">ec_rct1_list</span>, 
                                   formula <span class="op">=</span> <span class="va">ps_form_interaction</span>, 
                                   ydata_list <span class="op">=</span> <span class="va">y_list</span>,
                                   response <span class="op">=</span> <span class="va">RESPONSE</span>,
                                   id <span class="op">=</span> <span class="va">ID</span>, grp_id <span class="op">=</span> <span class="va">GRP_ID</span>,
                                   integer_grp_id <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<pre><code>## Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :
## Loglik converged before variable 1 ; coefficient may be infinite.

## Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights, :
## Loglik converged before variable 1 ; coefficient may be infinite.</code></pre>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">interaction_hr</span> <span class="op">&lt;-</span> <span class="fu">benchmark_hazard_ratios</span><span class="op">(</span><span class="va">interaction_ps_surv</span><span class="op">$</span><span class="va">ate</span>, benchmarks <span class="op">=</span> <span class="va">rct_hr</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">interaction_hr</span><span class="op">)</span></code></pre></div>
<p><img src="04-ate-trt-ec_files/figure-html/interactionHR-1.png" width="768"></p>
</div>
<div id="splines-in-the-propensity-score-model" class="section level2">
<h2 class="hasAnchor">
<a href="#splines-in-the-propensity-score-model" class="anchor"></a>Splines in the propensity score model</h2>
<p>We also modified the specification of the propensity score to include splines for the continuous covariates (age only), while removing the interaction term. Similar to above, we leverage the <code>update.grouped_ps_surv()</code> function to restimate <code>map_ps_surv()</code> while only modifying one argument (the propensity score model formula). This again results in some overfitting of the propensity score model.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ps_form_splines</span> <span class="op">&lt;-</span> <span class="fu">get_ps_formula</span><span class="op">(</span>spline <span class="op">=</span> <span class="cn">TRUE</span>, interaction <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">splines_ps_surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">interaction_ps_surv</span>, formula <span class="op">=</span> <span class="va">ps_form_splines</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">splines_hr</span> <span class="op">&lt;-</span> <span class="fu">benchmark_hazard_ratios</span><span class="op">(</span><span class="va">splines_ps_surv</span><span class="op">$</span><span class="va">ate</span>, benchmarks <span class="op">=</span> <span class="va">rct_hr</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">splines_hr</span><span class="op">)</span></code></pre></div>
<p><img src="04-ate-trt-ec_files/figure-html/splinesHr-1.png" width="768"></p>
</div>
<div id="splines-and-interaction-terms-in-the-propensity-score-model" class="section level2">
<h2 class="hasAnchor">
<a href="#splines-and-interaction-terms-in-the-propensity-score-model" class="anchor"></a>Splines and interaction terms in the propensity score model</h2>
<p>In a final check of the specification of the propensity score model, we include both splines and interaction terms, which not surprisingly results in predicted propensity scores of 0 and 1.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ps_form_splines_interaction</span> <span class="op">&lt;-</span> <span class="fu">get_ps_formula</span><span class="op">(</span>spline <span class="op">=</span> <span class="cn">TRUE</span>, interaction <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">splines_interaction_ps_surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">interaction_ps_surv</span>, 
                                      formula <span class="op">=</span> <span class="va">ps_form_splines_interaction</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<pre><code>## Warning: glm.fit: algorithm did not converge</code></pre>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<pre><code>## Warning: glm.fit: algorithm did not converge</code></pre>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<pre><code>## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading</code></pre>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<pre><code>## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading

## Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
## prediction from a rank-deficient fit may be misleading</code></pre>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred

## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">splines_interaction_hr</span> <span class="op">&lt;-</span> <span class="fu">benchmark_hazard_ratios</span><span class="op">(</span><span class="va">splines_interaction_ps_surv</span><span class="op">$</span><span class="va">ate</span>,
                                                  benchmarks <span class="op">=</span> <span class="va">rct_hr</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">splines_interaction_hr</span><span class="op">)</span></code></pre></div>
<p><img src="04-ate-trt-ec_files/figure-html/splinesInteractionHr-1.png" width="768"></p>
</div>
<div id="missing-indicators" class="section level2">
<h2 class="hasAnchor">
<a href="#missing-indicators" class="anchor"></a>Missing indicators</h2>
<p>Finally, we assessed whether combining multiple imputation with indicator variables for missing observations could <a href="https://doi.org/10.1186/s12874-020-01068-x">reduce bias</a>. An indicator variable was created for each variable with at least one missing observation (prior to imputation) and given a value of 1 if it was missing and 0 otherwise.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">missing_indicator_ps_surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">interaction_ps_surv</span>, 
                                    formula <span class="op">=</span> <span class="va">analysis</span><span class="op">$</span><span class="va">ps_formula</span>,
                                    missing_dummy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">missing_indicator_hr</span> <span class="op">&lt;-</span> <span class="fu">benchmark_hazard_ratios</span><span class="op">(</span><span class="va">missing_indicator_ps_surv</span><span class="op">$</span><span class="va">ate</span>, 
                                                benchmarks <span class="op">=</span> <span class="va">rct_hr</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">missing_indicator_hr</span><span class="op">)</span></code></pre></div>
<p><img src="04-ate-trt-ec_files/figure-html/missingIndicatorHr-1.png" width="768"></p>
</div>
</div>
<div id="summary-of-primary-and-sensitivity-analyses" class="section level1">
<h1 class="hasAnchor">
<a href="#summary-of-primary-and-sensitivity-analyses" class="anchor"></a>Summary of primary and sensitivity analyses</h1>
<p>Finally, we combine the hazard ratios across both the primary and the sensitivity analyses. We summarize the estimates across 14 pairwise comparisons by computing the root mean square error (RMSE) in comparisons of the estimated hazard ratios and RCT benchmarks. The “unadjusted” estimates surprisingly perform the best.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sensitivity_lookup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span>
   <span class="op">~</span><span class="va">id</span>, <span class="op">~</span><span class="va">Type</span>,  <span class="op">~</span><span class="va">`PS specification`</span>, <span class="op">~</span><span class="va">`Double adjustment`</span>, <span class="op">~</span><span class="va">`Missing data`</span>,
   <span class="st">"1"</span>, <span class="st">"Primary"</span>, <span class="st">"No interaction or splines"</span>, <span class="st">"No"</span>, <span class="st">"Multiple imputation"</span>,
   <span class="st">"2"</span>, <span class="st">"Sensitivty"</span>, <span class="st">"No interaction or splines"</span>, <span class="st">"No"</span>, <span class="st">"Multiple imputation"</span>,
   <span class="st">"3"</span>, <span class="st">"Sensitivty"</span>, <span class="st">"No interaction or splines"</span>, <span class="st">"Yes"</span>, <span class="st">"Multiple imputation"</span>,
   <span class="st">"4"</span>, <span class="st">"Sensitivty"</span>, <span class="st">"No interaction or splines"</span>, <span class="st">"Yes"</span>, <span class="st">"Multiple imputation"</span>,
   <span class="st">"5"</span>, <span class="st">"Sensitivty"</span>, <span class="st">"Splines and no interaction"</span>, <span class="st">"No"</span>, <span class="st">"Multiple imputation"</span>,
   <span class="st">"6"</span>, <span class="st">"Sensitivty"</span>, <span class="st">"Splines and interaction"</span>, <span class="st">"No"</span>, <span class="st">"Multiple imputation"</span>,
   <span class="st">"7"</span>, <span class="st">"Sensitivty"</span>, <span class="st">"No interaction or splines"</span>, <span class="st">"No"</span>, <span class="st">"Multiple imputation + missing indicator"</span>
<span class="op">)</span>

<span class="va">hr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  `1` <span class="op">=</span> <span class="va">primary_hr</span>,
  `2` <span class="op">=</span> <span class="va">psmethods_hr</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">method</span> <span class="op">!=</span> <span class="st">"iptw_att_trim"</span><span class="op">)</span>, 
  `3` <span class="op">=</span> <span class="va">da_hr</span>,
  `4` <span class="op">=</span> <span class="va">interaction_hr</span>,
  `5` <span class="op">=</span> <span class="va">splines_hr</span>,
  `6` <span class="op">=</span> <span class="va">splines_interaction_hr</span>,
  `7` <span class="op">=</span> <span class="va">missing_indicator_hr</span>
<span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">sensitivity_lookup</span>, by <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span>

<span class="va">rmse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">estimate</span>, <span class="va">truth</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">estimate</span> <span class="op">-</span> <span class="va">truth</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">hr</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">Type</span>, <span class="va">method</span>, <span class="va">`PS specification`</span>, <span class="va">`Double adjustment`</span>,
           <span class="va">`Missing data`</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>rmse <span class="op">=</span> <span class="fu">rmse</span><span class="op">(</span><span class="va">estimate</span>, <span class="va">benchmark_estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>method <span class="op">=</span> <span class="fu">label_ps_method</span><span class="op">(</span><span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">rmse</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>`PS method` <span class="op">=</span> <span class="va">method</span>, RMSE <span class="op">=</span> <span class="va">rmse</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">html_table</span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<table class="table table table-striped table-responsive">
<thead><tr>
<th style="text-align:left;">
Type
</th>
<th style="text-align:left;">
PS method
</th>
<th style="text-align:left;">
PS specification
</th>
<th style="text-align:left;">
Double adjustment
</th>
<th style="text-align:left;">
Missing data
</th>
<th style="text-align:right;">
RMSE
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
Unadjusted
</td>
<td style="text-align:left;">
No interaction or splines
</td>
<td style="text-align:left;">
Yes
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.2023938
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
Unadjusted
</td>
<td style="text-align:left;">
No interaction or splines
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.2034054
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
Unadjusted
</td>
<td style="text-align:left;">
No interaction or splines
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Multiple imputation + missing indicator
</td>
<td style="text-align:right;">
0.2034054
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
Unadjusted
</td>
<td style="text-align:left;">
Splines and interaction
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.2034054
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
Unadjusted
</td>
<td style="text-align:left;">
Splines and no interaction
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.2034054
</td>
</tr>
<tr>
<td style="text-align:left;">
Primary
</td>
<td style="text-align:left;">
IPTW-ATT (trim)
</td>
<td style="text-align:left;">
No interaction or splines
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.2248716
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
IPTW-ATT (trim)
</td>
<td style="text-align:left;">
No interaction or splines
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Multiple imputation + missing indicator
</td>
<td style="text-align:right;">
0.2269067
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
IPTW-ATT
</td>
<td style="text-align:left;">
No interaction or splines
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.2331213
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
IPTW-ATT (trim)
</td>
<td style="text-align:left;">
No interaction or splines
</td>
<td style="text-align:left;">
Yes
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.2336948
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
IPTW-ATT
</td>
<td style="text-align:left;">
No interaction or splines
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Multiple imputation + missing indicator
</td>
<td style="text-align:right;">
0.2358946
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
IPTW-ATT
</td>
<td style="text-align:left;">
No interaction or splines
</td>
<td style="text-align:left;">
Yes
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.2362500
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
IPTW-ATT (trim)
</td>
<td style="text-align:left;">
Splines and no interaction
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.2424755
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
Nearest neighbor matching (caliper)
</td>
<td style="text-align:left;">
No interaction or splines
</td>
<td style="text-align:left;">
Yes
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.2509127
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
IPTW-ATT (trim)
</td>
<td style="text-align:left;">
Splines and interaction
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.2510065
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
IPTW-ATT
</td>
<td style="text-align:left;">
Splines and no interaction
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.2531956
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
Nearest neighbor matching (caliper)
</td>
<td style="text-align:left;">
No interaction or splines
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.2581020
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
IPTW-ATT
</td>
<td style="text-align:left;">
Splines and interaction
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.2586702
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
Nearest neighbor matching (caliper)
</td>
<td style="text-align:left;">
Splines and no interaction
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.2591112
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
Genetic matching (caliper)
</td>
<td style="text-align:left;">
No interaction or splines
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.2699700
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
Nearest neighbor matching
</td>
<td style="text-align:left;">
No interaction or splines
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Multiple imputation + missing indicator
</td>
<td style="text-align:right;">
0.2705616
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
Nearest neighbor matching
</td>
<td style="text-align:left;">
No interaction or splines
</td>
<td style="text-align:left;">
Yes
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.2779954
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
Nearest neighbor matching
</td>
<td style="text-align:left;">
Splines and interaction
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.2794585
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
Genetic matching
</td>
<td style="text-align:left;">
No interaction or splines
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.2804645
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
Nearest neighbor matching
</td>
<td style="text-align:left;">
No interaction or splines
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.2832030
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
Nearest neighbor matching (caliper)
</td>
<td style="text-align:left;">
No interaction or splines
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Multiple imputation + missing indicator
</td>
<td style="text-align:right;">
0.3011221
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
Nearest neighbor matching (caliper)
</td>
<td style="text-align:left;">
Splines and interaction
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.3032752
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
Genetic matching
</td>
<td style="text-align:left;">
No interaction or splines
</td>
<td style="text-align:left;">
Yes
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.3178712
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
Nearest neighbor matching
</td>
<td style="text-align:left;">
Splines and no interaction
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.3188556
</td>
</tr>
<tr>
<td style="text-align:left;">
Sensitivty
</td>
<td style="text-align:left;">
Genetic matching (caliper)
</td>
<td style="text-align:left;">
No interaction or splines
</td>
<td style="text-align:left;">
Yes
</td>
<td style="text-align:left;">
Multiple imputation
</td>
<td style="text-align:right;">
0.3276925
</td>
</tr>
</tbody>
</table>
</div>
<div id="save-results" class="section level1">
<h1 class="hasAnchor">
<a href="#save-results" class="anchor"></a>Save results</h1>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">analysis</span><span class="op">$</span><span class="va">loghr_trt_ic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">rct_loghr</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span>, <span class="va">rct_loghr</span><span class="op">$</span><span class="va">analysis_num</span><span class="op">)</span>
<span class="va">analysis</span><span class="op">$</span><span class="va">loghr_trt_ec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op">(</span><span class="va">primary_ate</span><span class="op">$</span><span class="va">loghr</span><span class="op">)</span>, <span class="co"># Remove term column</span>
                                <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="st">"term"</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">analysis</span>, <span class="st">"analysis-ate-trt-ec.rds"</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Devin Incerti, Michael Bretscher, Ray Lin, Chris Harbron.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
