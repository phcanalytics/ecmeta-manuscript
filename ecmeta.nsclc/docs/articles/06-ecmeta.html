<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meta-analytic adjustment of hazard ratios for bias and variability • ecmeta.nsclc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Meta-analytic adjustment of hazard ratios for bias and variability">
<meta property="og:description" content="ecmeta.nsclc">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ecmeta.nsclc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">API</a>
</li>
<li>
  <a href="../sap/sap.pdf">Analysis plan</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/01-data-prep.html">Data preparation</a>
    </li>
    <li>
      <a href="../articles/02-impute.html">Imputation of missing data</a>
    </li>
    <li>
      <a href="../articles/03-balance.html">Propensity score estimation, weighting, and balance</a>
    </li>
    <li>
      <a href="../articles/04-ate-trt-ec.html">Treatment effect estimates: RCT experimental vs external control</a>
    </li>
    <li>
      <a href="../articles/05-ic-ec.html">Comparison of the internal and external control arms</a>
    </li>
    <li>
      <a href="../articles/06-ecmeta.html">Meta-analytic adjustment of hazard ratios</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/phcanalytics/ecmeta-manuscript/tree/main/ecmeta.nsclc/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="06-ecmeta_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="06-ecmeta_files/kePrint-0.0.1/kePrint.js"></script><link href="06-ecmeta_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Meta-analytic adjustment of hazard ratios for bias and variability</h1>
            
            <h4 class="date">2021-10-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/phcanalytics/ecmeta-manuscript/tree/main/ecmeta.nsclc/vignettes/06-ecmeta.Rmd"><code>vignettes/06-ecmeta.Rmd</code></a></small>
      <div class="hidden name"><code>06-ecmeta.Rmd</code></div>

    </div>

    
    
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<p>The objectives of this analysis is to apply the external control meta-analytic methodology (as described and implemented in the <a href="https://pages.github.roche.com/RWDScodeshare/ecmeta/"><code>ecmeta</code></a> package) to advanced non-small cell lung cancer (NSCLC). More specifically, we will use the 14 pairwise analyses as “reference studies” and show how they can be used to adjust log hazard ratio (HR) estimates from a single-arm trial (comparison of novel treatment arm with external control) for bias and variability. All estimates are based on the primary analysis detailed in <code><a href="../articles/04-ate-trt-ec.html">vignette("04-ate-trt-ec")</a></code>.</p>
<p>The following <code>R</code> packages and settings are used.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># R packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://mc-stan.org/bayesplot/">"bayesplot"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/phcanalytics/ecmeta">"ecmeta"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.roche.com/incertid/ecmeta-manuscript/tree/master/ecmeta.nsclc">"ecmeta.nsclc"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org">"dplyr"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://tidyr.tidyverse.org">"tidyr"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://haozhu233.github.io/kableExtra/">"kableExtra"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org">"ggplot2"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"gridExtra"</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="co"># MCMC settings</span>
<span class="va">N_CHAINS</span> <span class="op">=</span> <span class="fl">5</span>
<span class="va">N_BURNIN</span> <span class="op">&lt;-</span> <span class="fl">1000</span>
<span class="va">N_ITER</span> <span class="op">&lt;-</span> <span class="fl">2000</span></code></pre></div>
</div>
<div id="reference-studies" class="section level1">
<h1 class="hasAnchor">
<a href="#reference-studies" class="anchor"></a>Reference studies</h1>
<p>We read in the estimated log HRs from the 14 pairwise analyses and combine them into a single data frame.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">analysis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"analysis-ic-ec.rds"</span><span class="op">)</span>
<span class="va">loghr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span>
  trt_ec <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">analysis</span><span class="op">$</span><span class="va">loghr_trt_ec</span>, .id <span class="op">=</span> <span class="st">"analysis_num"</span><span class="op">)</span>,
  ic_ec <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">analysis</span><span class="op">$</span><span class="va">loghr_ic_ec</span>, .id <span class="op">=</span> <span class="st">"analysis_num"</span><span class="op">)</span>,
  trt_ic <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">analysis</span><span class="op">$</span><span class="va">loghr_trt_ic</span>, .id <span class="op">=</span> <span class="st">"analysis_num"</span><span class="op">)</span>,
  .id <span class="op">=</span> <span class="st">"param"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span><span class="va">analysis</span><span class="op">)</span></code></pre></div>
<p>The meta-analytic <a href="https://pages.github.roche.com/RWDScodeshare/ecmeta/articles/methodology.html">methodology</a> adjusts comparisons between the treatment arm and external control in a new study using the relationship,</p>
<p><span class="math display">\[
\lambda_{TRTvIC}^{new} =  \lambda_{TRTvEC}^{new} - \lambda_{ICvEC}^{new},
\]</span></p>
<p>where <span class="math inline">\(\lambda_{TRTvIC}\)</span>, <span class="math inline">\(\lambda_{TRTvEC}\)</span>, and <span class="math inline">\(\lambda_{ICvEC}\)</span> are the true log HRs for the treatment vs. internal control, treatment vs. external control, and internal control vs. external control, respectively. Under the assumption of proportional hazards, this relationship holds exactly for the true underlying hazard ratios. Here, we assess the extent to which it is a reasonable approximation for the estimated log hazard ratios, <span class="math inline">\(\hat{\lambda}\)</span>, in each study.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">loghr_wide</span> <span class="op">&lt;-</span> <span class="va">loghr</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">param</span>, <span class="va">analysis_num</span>, <span class="va">estimate</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"param"</span>,
              values_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"estimate"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>`trt_ec - ic_ec` <span class="op">=</span> <span class="va">trt_ec</span> <span class="op">-</span> <span class="va">ic_ec</span>,
         error <span class="op">=</span> <span class="va">trt_ic</span> <span class="op">-</span> <span class="op">(</span><span class="va">trt_ec</span> <span class="op">-</span> <span class="va">ic_ec</span><span class="op">)</span><span class="op">)</span>

<span class="va">loghr_wide</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kbl.html">kbl</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
analysis_num
</th>
<th style="text-align:right;">
trt_ec
</th>
<th style="text-align:right;">
ic_ec
</th>
<th style="text-align:right;">
trt_ic
</th>
<th style="text-align:right;">
trt_ec - ic_ec
</th>
<th style="text-align:right;">
error
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
-0.5503248
</td>
<td style="text-align:right;">
-0.2573927
</td>
<td style="text-align:right;">
-0.3166651
</td>
<td style="text-align:right;">
-0.2929321
</td>
<td style="text-align:right;">
-0.0237329
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
-0.6109938
</td>
<td style="text-align:right;">
-0.2503348
</td>
<td style="text-align:right;">
-0.3225064
</td>
<td style="text-align:right;">
-0.3606590
</td>
<td style="text-align:right;">
0.0381526
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
-0.3460089
</td>
<td style="text-align:right;">
-0.0918776
</td>
<td style="text-align:right;">
-0.2651754
</td>
<td style="text-align:right;">
-0.2541313
</td>
<td style="text-align:right;">
-0.0110441
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
-0.1135682
</td>
<td style="text-align:right;">
-0.0105633
</td>
<td style="text-align:right;">
-0.1274350
</td>
<td style="text-align:right;">
-0.1030048
</td>
<td style="text-align:right;">
-0.0244301
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
0.3826853
</td>
<td style="text-align:right;">
0.4613816
</td>
<td style="text-align:right;">
-0.1144784
</td>
<td style="text-align:right;">
-0.0786963
</td>
<td style="text-align:right;">
-0.0357821
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
0.1126034
</td>
<td style="text-align:right;">
-0.0909625
</td>
<td style="text-align:right;">
0.3247360
</td>
<td style="text-align:right;">
0.2035659
</td>
<td style="text-align:right;">
0.1211701
</td>
</tr>
<tr>
<td style="text-align:left;">
7
</td>
<td style="text-align:right;">
0.2892300
</td>
<td style="text-align:right;">
0.0597739
</td>
<td style="text-align:right;">
0.1377546
</td>
<td style="text-align:right;">
0.2294561
</td>
<td style="text-align:right;">
-0.0917016
</td>
</tr>
<tr>
<td style="text-align:left;">
8
</td>
<td style="text-align:right;">
-0.2779917
</td>
<td style="text-align:right;">
-0.2748500
</td>
<td style="text-align:right;">
0.0729703
</td>
<td style="text-align:right;">
-0.0031417
</td>
<td style="text-align:right;">
0.0761119
</td>
</tr>
<tr>
<td style="text-align:left;">
9
</td>
<td style="text-align:right;">
-0.0826667
</td>
<td style="text-align:right;">
-0.0977945
</td>
<td style="text-align:right;">
0.0256045
</td>
<td style="text-align:right;">
0.0151278
</td>
<td style="text-align:right;">
0.0104767
</td>
</tr>
<tr>
<td style="text-align:left;">
10
</td>
<td style="text-align:right;">
-0.1518520
</td>
<td style="text-align:right;">
-0.1879203
</td>
<td style="text-align:right;">
0.0383292
</td>
<td style="text-align:right;">
0.0360683
</td>
<td style="text-align:right;">
0.0022609
</td>
</tr>
<tr>
<td style="text-align:left;">
11
</td>
<td style="text-align:right;">
0.0848088
</td>
<td style="text-align:right;">
-0.1656664
</td>
<td style="text-align:right;">
0.2395422
</td>
<td style="text-align:right;">
0.2504752
</td>
<td style="text-align:right;">
-0.0109330
</td>
</tr>
<tr>
<td style="text-align:left;">
12
</td>
<td style="text-align:right;">
-0.4469054
</td>
<td style="text-align:right;">
-0.2435657
</td>
<td style="text-align:right;">
-0.2416314
</td>
<td style="text-align:right;">
-0.2033396
</td>
<td style="text-align:right;">
-0.0382918
</td>
</tr>
<tr>
<td style="text-align:left;">
13
</td>
<td style="text-align:right;">
-0.2867050
</td>
<td style="text-align:right;">
-0.1606752
</td>
<td style="text-align:right;">
-0.1443756
</td>
<td style="text-align:right;">
-0.1260298
</td>
<td style="text-align:right;">
-0.0183458
</td>
</tr>
<tr>
<td style="text-align:left;">
14
</td>
<td style="text-align:right;">
-0.1505189
</td>
<td style="text-align:right;">
0.0248768
</td>
<td style="text-align:right;">
-0.1439420
</td>
<td style="text-align:right;">
-0.1753957
</td>
<td style="text-align:right;">
0.0314537
</td>
</tr>
</tbody>
</table>
<p>We can also express the relationship in terms of hazard ratios, <span class="math inline">\(HR\)</span>,</p>
<p><span class="math display">\[
HR_{TRTvIC}^{new} =  \frac{HR_{TRTvEC}^{new}}{HR_{ICvEC}^{new}}. 
\]</span></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">loghr_wide</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.double</span><span class="op">)</span>, .fns <span class="op">=</span> <span class="va">exp</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>`error ratio` <span class="op">=</span> <span class="va">error</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kbl.html">kbl</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
analysis_num
</th>
<th style="text-align:right;">
trt_ec
</th>
<th style="text-align:right;">
ic_ec
</th>
<th style="text-align:right;">
trt_ic
</th>
<th style="text-align:right;">
trt_ec - ic_ec
</th>
<th style="text-align:right;">
error ratio
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.5767624
</td>
<td style="text-align:right;">
0.7730646
</td>
<td style="text-align:right;">
0.7285747
</td>
<td style="text-align:right;">
0.7460728
</td>
<td style="text-align:right;">
0.9765465
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
0.5428111
</td>
<td style="text-align:right;">
0.7785401
</td>
<td style="text-align:right;">
0.7243313
</td>
<td style="text-align:right;">
0.6972167
</td>
<td style="text-align:right;">
1.0388898
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
0.7075062
</td>
<td style="text-align:right;">
0.9122168
</td>
<td style="text-align:right;">
0.7670714
</td>
<td style="text-align:right;">
0.7755899
</td>
<td style="text-align:right;">
0.9890167
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
0.8926434
</td>
<td style="text-align:right;">
0.9894923
</td>
<td style="text-align:right;">
0.8803507
</td>
<td style="text-align:right;">
0.9021226
</td>
<td style="text-align:right;">
0.9758659
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
1.4662166
</td>
<td style="text-align:right;">
1.5862640
</td>
<td style="text-align:right;">
0.8918312
</td>
<td style="text-align:right;">
0.9243206
</td>
<td style="text-align:right;">
0.9648505
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
1.1191880
</td>
<td style="text-align:right;">
0.9130520
</td>
<td style="text-align:right;">
1.3836654
</td>
<td style="text-align:right;">
1.2257660
</td>
<td style="text-align:right;">
1.1288169
</td>
</tr>
<tr>
<td style="text-align:left;">
7
</td>
<td style="text-align:right;">
1.3353989
</td>
<td style="text-align:right;">
1.0615965
</td>
<td style="text-align:right;">
1.1476938
</td>
<td style="text-align:right;">
1.2579157
</td>
<td style="text-align:right;">
0.9123774
</td>
</tr>
<tr>
<td style="text-align:left;">
8
</td>
<td style="text-align:right;">
0.7573031
</td>
<td style="text-align:right;">
0.7596861
</td>
<td style="text-align:right;">
1.0756985
</td>
<td style="text-align:right;">
0.9968633
</td>
<td style="text-align:right;">
1.0790834
</td>
</tr>
<tr>
<td style="text-align:left;">
9
</td>
<td style="text-align:right;">
0.9206580
</td>
<td style="text-align:right;">
0.9068352
</td>
<td style="text-align:right;">
1.0259351
</td>
<td style="text-align:right;">
1.0152428
</td>
<td style="text-align:right;">
1.0105317
</td>
</tr>
<tr>
<td style="text-align:left;">
10
</td>
<td style="text-align:right;">
0.8591155
</td>
<td style="text-align:right;">
0.8286808
</td>
<td style="text-align:right;">
1.0390732
</td>
<td style="text-align:right;">
1.0367267
</td>
<td style="text-align:right;">
1.0022634
</td>
</tr>
<tr>
<td style="text-align:left;">
11
</td>
<td style="text-align:right;">
1.0885089
</td>
<td style="text-align:right;">
0.8473288
</td>
<td style="text-align:right;">
1.2706673
</td>
<td style="text-align:right;">
1.2846357
</td>
<td style="text-align:right;">
0.9891265
</td>
</tr>
<tr>
<td style="text-align:left;">
12
</td>
<td style="text-align:right;">
0.6396044
</td>
<td style="text-align:right;">
0.7838280
</td>
<td style="text-align:right;">
0.7853456
</td>
<td style="text-align:right;">
0.8160011
</td>
<td style="text-align:right;">
0.9624321
</td>
</tr>
<tr>
<td style="text-align:left;">
13
</td>
<td style="text-align:right;">
0.7507331
</td>
<td style="text-align:right;">
0.8515686
</td>
<td style="text-align:right;">
0.8655626
</td>
<td style="text-align:right;">
0.8815886
</td>
<td style="text-align:right;">
0.9818215
</td>
</tr>
<tr>
<td style="text-align:left;">
14
</td>
<td style="text-align:right;">
0.8602615
</td>
<td style="text-align:right;">
1.0251888
</td>
<td style="text-align:right;">
0.8659380
</td>
<td style="text-align:right;">
0.8391249
</td>
<td style="text-align:right;">
1.0319536
</td>
</tr>
</tbody>
</table>
</div>
<div id="example-analysis-for-new-study" class="section level1">
<h1 class="hasAnchor">
<a href="#example-analysis-for-new-study" class="anchor"></a>Example analysis for new study</h1>
<p>Consider a hypothetical new single-arm study that compared a novel treatment with an external control. The estimated HR is 0.7 and the standard error is set equal to the median of the standard error (0.148) from the references studies.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_loghr_trt_ec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ecmeta/man/loghr_data.html">loghr_data</a></span><span class="op">(</span>
  estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">.7</span><span class="op">)</span>,
  standard_error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">loghr</span><span class="op">[</span><span class="va">loghr</span><span class="op">$</span><span class="va">param</span> <span class="op">==</span> <span class="st">"trt_ec"</span>, <span class="op">]</span><span class="op">$</span><span class="va">se</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>In this example, we show how to use the reference studies to adjust the HR from this single-arm study for bias and variability.</p>
<div id="estimation-of-meta-analytic-model" class="section level2">
<h2 class="hasAnchor">
<a href="#estimation-of-meta-analytic-model" class="anchor"></a>Estimation of meta-analytic model</h2>
<p>An example analysis proceeds by first using the historical data to estimate the parameters of the meta-analytic model. The model estimates the log HR in a comparison of the internal and external control arms.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Setup data</span>
<span class="va">loghr_ic_ec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ecmeta/man/as_loghr_data.html">as_loghr_data</a></span><span class="op">(</span>
  <span class="va">loghr</span><span class="op">[</span><span class="va">loghr</span><span class="op">$</span><span class="va">param</span> <span class="op">==</span> <span class="st">"ic_ec"</span>, <span class="op">]</span>,
  estimate <span class="op">=</span> <span class="st">"estimate"</span>, standard_error <span class="op">=</span> <span class="st">"se"</span>
<span class="op">)</span>

<span class="co"># Estimate the model</span>
<span class="va">loghr_ecmeta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ecmeta/man/ecmeta.html">ecmeta</a></span><span class="op">(</span>
  <span class="va">loghr_ic_ec</span>, method <span class="op">=</span> <span class="st">"jags"</span>,
  n_iter <span class="op">=</span> <span class="va">N_ITER</span>, n_chains <span class="op">=</span> <span class="va">N_CHAINS</span>, n_burnin <span class="op">=</span> <span class="va">N_BURNIN</span>,
  prior_scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ecmeta/man/priors.html">student_t</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span>, <span class="fl">1</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 14
##    Unobserved stochastic nodes: 16
##    Total graph size: 80
## 
## Initializing model</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">loghr_ecmeta</span></code></pre></div>
<pre><code>## Iterations = 2001:4000
## Thinning interval = 1 
## Number of chains = 5 
## Sample size per chain = 2000 
## 
##   param        mean     se_naive       se_ts         sd        2.5%         25%
## 1    mu -0.09739893 0.0005191603 0.001062963 0.05191603 -0.19940448 -0.12985346
## 2 sigma  0.11989791 0.0006494413 0.002969182 0.06494413  0.01356759  0.07282673
##           50%         75%       97.5%     rhat
## 1 -0.09828602 -0.06511371 0.007326209 1.000389
## 2  0.11428862  0.16031204 0.262798236 1.006641</code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-distributions.html">mcmc_hist</a></span><span class="op">(</span><span class="va">loghr_ecmeta</span>, binwidth <span class="op">=</span> <span class="fl">.005</span><span class="op">)</span></code></pre></div>
<p><img src="06-ecmeta_files/figure-html/ecmetaHist-1.png" width="768"></p>
<p><span class="math inline">\(\mu\)</span> is an estimate of the bias of the external control relative to the internal control. The estimate is negative, <span class="math inline">\(\hat{\mu}\)</span> = -0.098, which suggests that external control patients had, on average, shorter survival than trial controls, even after propensity score adjustment. The quantity, <span class="math inline">\(\hat{\sigma}\)</span> = 0.114, is an estimate of the extent to which the log HRs vary across the reference studies.</p>
</div>
<div id="adjustment" class="section level2">
<h2 class="hasAnchor">
<a href="#adjustment" class="anchor"></a>Adjustment</h2>
<p>An adjustment of the log HR is performed using the <code>ecmeta::predict()</code> function, which “predicts” <span class="math inline">\(\lambda_{TRTvIC}^{new}\)</span>, the true log HR (treatment vs. internal control), using (i) the meta-analytic model above and (ii) <span class="math inline">\(\hat{\lambda}_{TRTvEC}^{new}\)</span>, the estimates of the log HR (treatment vs. external control) from the single-arm study.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">loghr_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">loghr_ecmeta</span>, newdata <span class="op">=</span> <span class="va">new_loghr_trt_ec</span><span class="op">)</span></code></pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 1
##    Unobserved stochastic nodes: 1
##    Total graph size: 9
## 
## Initializing model</code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">loghr_new</span></code></pre></div>
<pre><code>## Posterior sampling was performed for the true log HR of the treatment 
## relative to the external control ('loghr_trt_ec') with the following settings:
## 
## Iterations = 1:2000
## Thinning interval = 1 
## Number of chains = 5 
## Sample size per chain = 2000 
## 
## The estimates of 'mu' and 'sigma' were used to draw the true log HR of the 
## internal control relative to the external control ('loghr_ic_ec'), which was 
## in turn, used to adjust 'log_trt_ec' to obtain the predicted log HR 
## for the treatment relative to a hypothetical internal control ('loghr_trt_ic').
## 
## Summaries of the posterior distributions are displayed below:
##          param        mean    se_naive        sd       2.5%        25%
## 1 loghr_trt_ic -0.25724458 0.002071504 0.2071504 -0.6658046 -0.3892399
## 2 loghr_trt_ec -0.35565173 0.001495050 0.1495050 -0.6456964 -0.4569179
## 3  loghr_ic_ec -0.09840715 0.001457516 0.1457516 -0.3989943 -0.1718717
##          50%         75%       97.5%     rhat
## 1 -0.2577993 -0.12613466  0.15638402       NA
## 2 -0.3573240 -0.25689634 -0.06143809 1.000037
## 3 -0.1003744 -0.02649346  0.20936848       NA</code></pre>
<p>It is perhaps more convenient to summarize the HRs.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">loghr_new</span>, exponentiate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>##       param      mean    se_naive        sd      2.5%       25%       50%
## 1 hr_trt_ic 0.7899704 0.001667533 0.1667533 0.5138599 0.6775717 0.7727503
## 2 hr_trt_ec 0.7086090 0.001068986 0.1068986 0.5242973 0.6332323 0.6995458
## 3  hr_ic_ec 0.9160820 0.001388708 0.1388708 0.6709945 0.8420872 0.9044987
##         75%     97.5%     rhat
## 1 0.8814961 1.1692752       NA
## 2 0.7734484 0.9404112 1.000037
## 3 0.9738544 1.2328992       NA</code></pre>
<p>The mean of the true HR is pushed upwards because internal control patients tended to survive longer than the external control patients (<span class="math inline">\(\hat{\mu}\)</span> = -0.098). Furthermore, confidence intervals are larger for the true HR because of the variance of the estimates of <span class="math inline">\(\lambda_{ICvEC}\)</span> across the reference studies (<span class="math inline">\(\hat{\sigma}\)</span> = 0.114).</p>
<p>We can also plot posterior densities of the hazard ratios using the <code>bayesplot</code> package.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">loghr_seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.8</span>, <span class="fl">.4</span>, by <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span>
<span class="va">loghr_labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span>
  <span class="st">"log("</span>, 
  <span class="fu"><a href="https://rdrr.io/r/base/formatc.html">formatC</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">loghr_seq</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"f"</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,
  <span class="st">")"</span>
<span class="op">)</span>
<span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-intervals.html">mcmc_areas</a></span><span class="op">(</span><span class="va">loghr_new</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"trt_ic"</span>, <span class="st">"trt_ec"</span><span class="op">)</span>,
           point_est <span class="op">=</span> <span class="st">"median"</span>, prob <span class="op">=</span> <span class="fl">.95</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"trt_ic"</span> <span class="op">=</span> <span class="st">"TRTvIC"</span>, <span class="st">"trt_ec"</span> <span class="op">=</span> <span class="st">"TRTvEC"</span><span class="op">)</span>,
                   expand <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expansion.html">expansion</a></span><span class="op">(</span>add <span class="op">=</span> <span class="fl">.05</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="va">loghr_seq</span>, labels <span class="op">=</span> <span class="va">loghr_labs</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Log hazard ratio"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">loghr_seq</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">loghr_seq</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="06-ecmeta_files/figure-html/loghrNewMcmcArea-1.png" width="672"></p>
</div>
</div>
<div id="model-checking" class="section level1">
<h1 class="hasAnchor">
<a href="#model-checking" class="anchor"></a>Model checking</h1>
<p>We check the model using leave-one-out cross validation (LOO CV) in which we use one of the reference studies for “testing” and the remaining for “training”. Since there are 14 reference studies, LOO CV produces 14 predictions, which we call <span class="math inline">\(\hat{y}\)</span>. Predictions are made in two ways: first, “unadjusted” predictions are made using <span class="math inline">\(\hat{y}=\hat{\lambda}_{TRTvEC}^{new}\)</span>, and second, adjusted predictions are made using <span class="math inline">\(\hat{y} = E(\lambda_{TRTvIC}^{new})\)</span>. In the adjusted case, the meta-analytic model is fit to the training data using <code><a href="https://rdrr.io/pkg/ecmeta/man/ecmeta.html">ecmeta::ecmeta()</a></code> and predictions are made on the test set with <code><a href="https://rdrr.io/pkg/ecmeta/man/predict.ecmeta.html">ecmeta::predict.ecmeta()</a></code></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ecmeta_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ecmeta_lpo_cv.html">ecmeta_lpo_cv</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">loghr</span>, p <span class="op">=</span> <span class="fl">1</span>, 
  method <span class="op">=</span> <span class="st">"jags"</span>,
  ecmeta_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>n_chains <span class="op">=</span> <span class="fl">5</span>, n_iter <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>We compute residuals as <span class="math inline">\(y - \hat{y}\)</span> and plot the density of the residuals. The unadjusted method produced results that are more biased (external control patients tend to have shorter survival than internal control patients), although neither method produces density functions that are centered at zero.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_residual</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">cv</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">cv</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">std_residual</span>, col <span class="op">=</span> <span class="va">adjust</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Residuals"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html">scale_color_discrete</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Adjustment"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu">plot_residual</span><span class="op">(</span><span class="va">ecmeta_cv</span><span class="op">)</span></code></pre></div>
<p><img src="06-ecmeta_files/figure-html/ecmetaCVResidualsDensity-1.png" width="768"></p>
<p>The distribution is not symmetric and has a longer right tail. This seems to be primarily caused by the 5th reference study for which <span class="math inline">\(\hat{\lambda}_{ICvEC}^{new}\)</span> was much larger than 1 (i.e., the external control patients lived longer than internal control patients). Removing this study results in a density plot that resembles a normal distribution, although it is still not centered at zero.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plot_residual</span><span class="op">(</span><span class="va">ecmeta_cv</span><span class="op">[</span><span class="va">ecmeta_cv</span><span class="op">$</span><span class="va">iteration</span> <span class="op">!=</span> <span class="fl">5</span>, <span class="op">]</span><span class="op">)</span></code></pre></div>
<p><img src="06-ecmeta_files/figure-html/unnamed-chunk-3-1.png" width="768"></p>
<p>Note that the mean residual is closer to zero than the median residual.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ecmeta_cv</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">adjust</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_residual <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">residual</span><span class="op">)</span>,
            median_residual <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">residual</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   adjust mean_residual median_residual
##   &lt;chr&gt;          &lt;dbl&gt;           &lt;dbl&gt;
## 1 No           0.0931           0.149 
## 2 Yes         -0.00450          0.0572</code></pre>
<p>We can also use a QQ-plot to compare standardized residuals to those from a theoretical normal distribution. Residuals were standardized by dividing them by the standard deviation of <span class="math inline">\(\hat{\lambda}_{TRTvIC}^{new}\)</span>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ecmeta_cv</span> <span class="op">%&gt;%</span>
         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>adjustf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Adjust = "</span>, <span class="va">adjust</span><span class="op">)</span><span class="op">)</span>, 
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">std_residual</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html">stat_qq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
 <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>,intercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">adjustf</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Theoretical (normal distribution)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Actual residuals"</span><span class="op">)</span></code></pre></div>
<p><img src="06-ecmeta_files/figure-html/ecmetaCVResidualsQQ-1.png" width="768"></p>
</div>
<div id="sensitivity-analyes" class="section level1">
<h1 class="hasAnchor">
<a href="#sensitivity-analyes" class="anchor"></a>Sensitivity analyes</h1>
<div id="removing-outliers" class="section level2">
<h2 class="hasAnchor">
<a href="#removing-outliers" class="anchor"></a>Removing outliers</h2>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">loghr_ecmeta_no5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ecmeta/man/ecmeta.html">ecmeta</a></span><span class="op">(</span>
  <span class="va">loghr_ic_ec</span><span class="op">[</span><span class="op">-</span><span class="fl">5</span>, <span class="op">]</span>, 
  n_chains <span class="op">=</span> <span class="va">N_CHAINS</span>, n_iter <span class="op">=</span> <span class="va">N_ITER</span>, n_burnin <span class="op">=</span> <span class="va">N_BURNIN</span>,
  method <span class="op">=</span> <span class="st">"jags"</span>,
  prior_scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ecmeta/man/priors.html">student_t</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 13
##    Unobserved stochastic nodes: 15
##    Total graph size: 75
## 
## Initializing model</code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">loghr_ecmeta_no5</span></code></pre></div>
<pre><code>## Iterations = 2001:4000
## Thinning interval = 1 
## Number of chains = 5 
## Sample size per chain = 2000 
## 
##   param       mean     se_naive       se_ts         sd         2.5%         25%
## 1    mu -0.1322965 0.0004364043 0.001619700 0.04364043 -0.220139702 -0.15974147
## 2 sigma  0.0670363 0.0004276455 0.002362741 0.04276455  0.005430164  0.03443469
##           50%         75%       97.5%     rhat
## 1 -0.13195828 -0.10430584 -0.04433135 1.001890
## 2  0.06087713  0.09179799  0.16786937 1.008979</code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-traces.html">mcmc_trace</a></span><span class="op">(</span><span class="va">loghr_ecmeta_no5</span><span class="op">)</span></code></pre></div>
<p><img src="06-ecmeta_files/figure-html/ecmetaNo5Trace-1.png" width="768"></p>
</div>
<div id="estimation-of-sigma" class="section level2">
<h2 class="hasAnchor">
<a href="#estimation-of-sigma" class="anchor"></a>Estimation of sigma</h2>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Inverse gamma prior</span>
<span class="va">loghr_ecmeta_ig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ecmeta/man/ecmeta.html">ecmeta</a></span><span class="op">(</span>
  <span class="va">loghr_ic_ec</span>, method <span class="op">=</span> <span class="st">"jags"</span>,
  n_iter <span class="op">=</span> <span class="va">N_ITER</span>, n_chains <span class="op">=</span> <span class="va">N_CHAINS</span>, n_burnin <span class="op">=</span> <span class="va">N_BURNIN</span>,
  prior_scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ecmeta/man/priors.html">invgamma</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">0.001</span><span class="op">)</span>,
  quiet <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="co"># Uniform prior</span>
<span class="va">loghr_ecmeta_unif</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ecmeta/man/ecmeta.html">ecmeta</a></span><span class="op">(</span>
  <span class="va">loghr_ic_ec</span>, method <span class="op">=</span> <span class="st">"jags"</span>,
  n_iter <span class="op">=</span> <span class="va">N_ITER</span>, n_chains <span class="op">=</span> <span class="va">N_CHAINS</span>, n_burnin <span class="op">=</span> <span class="va">N_BURNIN</span>,
  prior_scale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ecmeta/man/priors.html">uniform</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>, 
  quiet <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="co"># Maximum-likelihood approach</span>
<span class="va">loghr_ecmeta_ml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ecmeta/man/ecmeta.html">ecmeta</a></span><span class="op">(</span>
  <span class="va">loghr_ic_ec</span>, method <span class="op">=</span> <span class="st">"ml"</span>
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Posterior distributions by combining chains</span>
<span class="va">sigma_post_hc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/array.html">as.array</a></span><span class="op">(</span><span class="va">loghr_ecmeta</span><span class="op">)</span><span class="op">[</span>,, <span class="st">"sigma"</span><span class="op">]</span><span class="op">)</span>
<span class="va">sigma_post_ig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/array.html">as.array</a></span><span class="op">(</span><span class="va">loghr_ecmeta_ig</span><span class="op">)</span><span class="op">[</span>,, <span class="st">"sigma"</span><span class="op">]</span><span class="op">)</span>
<span class="va">sigma_post_unif</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/array.html">as.array</a></span><span class="op">(</span><span class="va">loghr_ecmeta_unif</span><span class="op">)</span><span class="op">[</span>,, <span class="st">"sigma"</span><span class="op">]</span><span class="op">)</span>
<span class="va">sigma_post_ml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span>
  <span class="va">N_ITER</span> <span class="op">*</span> <span class="va">N_CHAINS</span>,
  <span class="va">loghr_ecmeta_ml</span><span class="op">$</span><span class="va">estimates</span><span class="op">[</span><span class="st">"logsigma"</span><span class="op">]</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">loghr_ecmeta_ml</span><span class="op">$</span><span class="va">vcov</span><span class="op">[</span><span class="st">"logsigma"</span>, <span class="st">"logsigma"</span><span class="op">]</span><span class="op">)</span>
<span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Combine into single object for plotting</span>
<span class="va">sigma_post</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Bayesian: half-Cauchy prior"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sigma_post_hc</span><span class="op">)</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Bayesian: inverse gamma prior"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sigma_post_ig</span><span class="op">)</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Bayesian: uniform prior"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sigma_post_unif</span><span class="op">)</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"Maximum likelihood"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sigma_post_unif</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>,
  value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sigma_post_hc</span>, <span class="va">sigma_post_ig</span>, <span class="va">sigma_post_unif</span>, <span class="va">sigma_post_ml</span><span class="op">)</span>
<span class="op">)</span> 

<span class="co"># Plot</span>
<span class="va">tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">sigma_post</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">label</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>
    Mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>,
    Median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>,
    `2.5%` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">value</span>, <span class="fl">.025</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>,
    `97.5%` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">value</span>, <span class="fl">.975</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span>
  <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">tbl</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">""</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">sigma_post</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, colour <span class="op">=</span> <span class="va">label</span>, linetype <span class="op">=</span> <span class="va">label</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.6</span>, <span class="fl">.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html">scale_colour_discrete</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_linetype.html">scale_linetype_discrete</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">.6</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"sigma"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, legend.box <span class="op">=</span> <span class="st">"vertical"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/tableGrob.html">tableGrob</a></span><span class="op">(</span>
      <span class="va">tbl</span>, rows <span class="op">=</span> <span class="cn">NULL</span>,
      theme <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/tableGrob.html">ttheme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>
    <span class="op">)</span>,
    xmin <span class="op">=</span> <span class="fl">0.25</span>
  <span class="op">)</span> </code></pre></div>
<p><img src="06-ecmeta_files/figure-html/ecmetaPriorSensitivityPlot-1.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Devin Incerti, Michael Bretscher, Ray Lin, Chris Harbron.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
